# Интеграция загрузки файлов и проектов в Neural Chat

## Обзор

Была реализована полноценная интеграция загрузки файлов в чаты с поддержкой проектов как контекста, аналогично десктопной версии Claude.

## Новые возможности

### 1. Загрузка файлов в чаты
- **Drag & Drop интерфейс** - перетаскивание файлов прямо в область чата
- **Кнопка прикрепления** - выбор файлов через стандартный диалог
- **Предварительный просмотр** - отображение прикрепленных файлов с иконками и размерами
- **Валидация файлов** - проверка типов и размеров файлов
- **Поддержка множественных файлов** - до 50MB на файл

### 2. Интеграция с проектами
- **Выбор проекта как контекста** - dropdown для выбора проекта
- **Автоматическое прикрепление файлов проекта** - все файлы проекта передаются как контекст
- **Визуальный индикатор** - отображение файлов проекта в интерфейсе
- **Сворачиваемый список** - компактное отображение файлов проекта

### 3. Обработка файлов на backend
- **Чтение содержимого файлов** - автоматическое извлечение текста из файлов проекта
- **Создание контекста** - формирование структурированного контекста для AI
- **Поддержка различных типов файлов** - код, документы, конфигурации

## Технические детали

### Frontend изменения

#### MessageInput.tsx
- Добавлен drag & drop с `react-dropzone`
- Интеграция с API проектов через `@tanstack/react-query`
- Компонент выбора проекта
- Отображение файлов проекта как контекста
- Улучшенная обработка ошибок

#### ProjectFilesIndicator.tsx
- Новый компонент для отображения файлов проекта
- Поддержка сворачивания/разворачивания
- Иконки для разных типов файлов
- Tooltips с информацией о файлах

#### MessageList.tsx
- Интеграция ProjectFilesIndicator
- Разделение обычных вложений и файлов проекта
- Улучшенное отображение контекста

#### Chat.tsx
- Поддержка состояния выбранного проекта
- Передача projectFiles в API
- Обработка выбора проекта

### Backend изменения

#### message.controller.js
- Поддержка `projectFiles` и `projectId` в запросах
- Объединение обычных вложений с файлами проекта
- Интеграция с утилитой обработки файлов

#### message.model.js
- Добавлено поле `projectId`
- Расширена схема `attachments` для поддержки файлов проекта
- Поля `isProjectFile` и `data` для файлов

#### fileProcessor.js (новый)
- Утилиты для чтения содержимого файлов
- Определение типов файлов
- Создание структурированного контекста для AI
- Обработка текстовых и бинарных файлов

## Поддерживаемые типы файлов

### Текстовые файлы (читаются полностью)
- Код: `.js`, `.jsx`, `.ts`, `.tsx`, `.py`, `.java`, `.cpp`, `.c`, `.php`, `.rb`, `.go`, `.rs`
- Разметка: `.html`, `.css`, `.scss`, `.md`, `.xml`
- Конфигурации: `.json`, `.yaml`, `.yml`, `.toml`, `.ini`, `.env`
- Документы: `.txt`, `.csv`, `.sql`

### Бинарные файлы (отображается информация)
- Изображения: `.png`, `.jpg`, `.jpeg`, `.gif`, `.webp`, `.svg`
- Документы: `.pdf`, `.doc`, `.docx`

## Использование

### 1. Загрузка файлов в чат
1. Перетащите файлы в область чата или нажмите кнопку прикрепления
2. Файлы отобразятся в предварительном просмотре
3. Отправьте сообщение - файлы будут переданы AI как контекст

### 2. Использование проектов как контекста
1. Выберите проект из dropdown "Проект (контекст)"
2. Файлы проекта автоматически отобразятся как контекст
3. При отправке сообщения все файлы проекта будут переданы AI
4. AI получит полное содержимое текстовых файлов проекта

### 3. Комбинирование файлов и проектов
- Можно одновременно прикрепить файлы и выбрать проект
- Все файлы (прикрепленные + из проекта) передаются AI
- Визуально разделены обычные вложения и файлы проекта

## Примеры использования

### Разработка кода
1. Создайте проект и загрузите файлы кода
2. В чате выберите этот проект как контекст
3. Задавайте вопросы о коде - AI будет видеть весь проект

### Анализ документов
1. Прикрепите документы к сообщению
2. AI проанализирует содержимое и ответит на вопросы

### Работа с конфигурациями
1. Загрузите конфигурационные файлы в проект
2. AI поможет с настройкой и отладкой

## Ограничения

- Максимальный размер файла: 50MB
- Бинарные файлы передаются только как метаданные
- Контекст ограничен размером модели AI
- Файлы проекта читаются с диска при каждом запросе

## Безопасность

- Файлы сохраняются в защищенной директории
- Проверка прав доступа к проектам
- Валидация типов файлов
- Ограничения на размер файлов

## Производительность

- Асинхронная обработка файлов
- Кэширование метаданных проектов
- Оптимизированное чтение файлов
- Streaming ответов AI

## Совместимость

Функциональность полностью совместима с:
- Существующими чатами
- Всеми типами AI моделей (Claude, Grok)
- Мобильными устройствами
- Различными браузерами

## Миграция

Существующие чаты и проекты продолжают работать без изменений. Новая функциональность доступна сразу после обновления. 